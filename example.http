GET https://qrlew-zsyaspsckq-od.a.run.app/ HTTP/1.2

### Check the public key
GET https://qrlew-zsyaspsckq-od.a.run.app/public_key HTTP/1.2

### Get a dot representation of the Relation
POST https://qrlew-zsyaspsckq-od.a.run.app/dot HTTP/1.2
content-type: application/json

{"dataset":{"tables":[{"name":"table_1","path":["schema","table_1"],"schema":{"fields":[{"name":"a","data_type":"Float"},{"name":"b","data_type":"Integer"}]},"size":10000}]},"query":"SELECT * FROM table_1","dark_mode":false}

### Get the pep version of the relation
POST https://qrlew-zsyaspsckq-od.a.run.app/rewrite_as_protected_entity_preserving HTTP/1.2
content-type: application/json

{"dataset":{"tables":[{"name":"user_table","path":["schema","user_table"],"schema":{"fields":[{"name":"id","data_type":"Integer"},{"name":"name","data_type":"Text"},{"name":"age","data_type":"Integer"},{"name":"weight","data_type":"Float"}]},"size":10000},{"name":"action_table","path":["schema","action_table"],"schema":{"fields":[{"name":"action","data_type":"Text"},{"name":"user_id","data_type":"Integer"},{"name":"duration","data_type":"Float"}]},"size":10000}]},"query":"SELECT * FROM action_table","synthetic_data":[["user_table","synthetic_user_table"],["action_table","synthetic_action_table"]],"protected_entity":[["user_table",[],"id"],["action_table",[["user_id","user_table","id"]],"id"]],"epsilon":1.0,"delta":0.00001}

### Get the dp version of the relation
POST https://qrlew-zsyaspsckq-od.a.run.app/rewrite_with_differential_privacy HTTP/1.2
content-type: application/json

{"dataset":{"tables":[{"name":"user_table","path":["schema","user_table"],"schema":{"fields":[{"name":"id","data_type":"Integer"},{"name":"name","data_type":"Text"},{"name":"age","data_type":"Integer"},{"name":"weight","data_type":"Float"}]},"size":10000},{"name":"action_table","path":["schema","action_table"],"schema":{"fields":[{"name":"action","data_type":"Text"},{"name":"user_id","data_type":"Integer"},{"name":"duration","data_type":"Float"}]},"size":10000}]},"query":"SELECT sum(duration) FROM action_table WHERE duration > 0 AND duration < 24","synthetic_data":[["user_table","synthetic_user_table"],["action_table","synthetic_action_table"]],"protected_entity":[["user_table",[],"id"],["action_table",[["user_id","user_table","id"]],"id"]],"epsilon":1.0,"delta":0.00001}


### Verify the dp version of the relation
POST https://qrlew-zsyaspsckq-od.a.run.app/verify HTTP/1.2
content-type: application/json

{
  "value": "WITH join_8sh3 (field_p7b0, field_sjgm, field_bhim, field_0lza, field_hbhz, field_vyw9, field_4wsv) AS (SELECT * FROM schema.user_table AS _LEFT_ JOIN schema.action_table AS _RIGHT_ ON (_RIGHT_.user_id) = (_LEFT_.id)), map_phke (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, action, user_id, duration) AS (SELECT md5(CAST(field_p7b0 AS VARCHAR)) AS _PROTECTED_ENTITY_ID_, 1 AS _PROTECTED_ENTITY_WEIGHT_, field_hbhz AS action, field_vyw9 AS user_id, field_4wsv AS duration FROM join_8sh3), map_kzp0 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, duration AS field_8mze FROM map_phke WHERE ((duration) > (0)) AND ((duration) < (24))), map_vb83 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, field_8mze AS field_8mze FROM map_kzp0), map_jpue (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_vb83), reduce_ri5s (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_jpue GROUP BY field_6zur), map_7t04 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, abs((field_8mze) * ((field_8mze))) AS field_8mze FROM reduce_ri5s), map_tgvp (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_7t04), reduce_d_vq (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_tgvp GROUP BY field_6zur), map_dyq9 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, (1) / ((greatest(1, (sqrt(field_8mze)) / ((24))))) AS field_8mze FROM reduce_d_vq), join_wd2i (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT * FROM map_vb83 AS _LEFT_ JOIN map_dyq9 AS _RIGHT_ ON (_LEFT_._PROTECTED_ENTITY_ID_) = (_RIGHT_._PROTECTED_ENTITY_ID_)), map_07e6 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, (field_8mze) * ((_SCALE_FACTOR_field_8mze)) AS field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_ AS _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze AS _SCALE_FACTOR_field_8mze FROM join_wd2i), map__ivg (field_b_lu) AS (SELECT field_8mze AS field_b_lu FROM map_07e6), reduce_xmbc (field_8mze) AS (SELECT sum(field_b_lu) AS field_8mze FROM map__ivg), map_nmqi (_SUM_field_8mze) AS (SELECT least(2400000000, greatest(0, (field_8mze) + ((239.31951076972163) * (((sqrt((-2) * ((ln(random()))))) * ((cos((6.283185307179586) * ((random())))))))))) AS _SUM_field_8mze FROM reduce_xmbc), map_2u6g (field_nnl2) AS (SELECT _SUM_field_8mze AS field_nnl2 FROM map_nmqi) SELECT * FROM map_2u6g",
  "signature": "SBUJbslAMswREXP90hdoB2TxgyETnBDZ0FXMcKJtv5YKlBOhyG9+z1nAS6ewmoiD8fl+4GZZV9W7YwNWVh6bxEsM8ThSGeddX2Jh/blVGWgn8+vmn1et98dKVX/Bmg/4PKGOmOx9xGCEQEgclx2cdineIVppwXetHFLGMmmcJ28AFS+JUQqlmnQ6LqqqR8VrL68et8QmQasnBQOkW+gYIa+7XTl05BEiMI+WH4Cn/CNfPnpOygudkp1yFXP5YtbO3X5zo3TzDGltbg1yApVJouYGwqVCbSQTLQj1tjJlE6MIVHrt0Yg172qi0jC+6SZtxlWbQn/mDhN9s91tiB8BOA"
}

### Verify the dp version of the relation (altered request)
POST https://qrlew-zsyaspsckq-od.a.run.app/verify HTTP/1.2
content-type: application/json

{
  "value": "WITH _join_8sh3 (field_p7b0, field_sjgm, field_bhim, field_0lza, field_hbhz, field_vyw9, field_4wsv) AS (SELECT * FROM schema.user_table AS _LEFT_ JOIN schema.action_table AS _RIGHT_ ON (_RIGHT_.user_id) = (_LEFT_.id)), map_phke (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, action, user_id, duration) AS (SELECT md5(CAST(field_p7b0 AS VARCHAR)) AS _PROTECTED_ENTITY_ID_, 1 AS _PROTECTED_ENTITY_WEIGHT_, field_hbhz AS action, field_vyw9 AS user_id, field_4wsv AS duration FROM join_8sh3), map_kzp0 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, duration AS field_8mze FROM map_phke WHERE ((duration) > (0)) AND ((duration) < (24))), map_vb83 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, field_8mze AS field_8mze FROM map_kzp0), map_jpue (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_vb83), reduce_ri5s (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_jpue GROUP BY field_6zur), map_7t04 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, abs((field_8mze) * ((field_8mze))) AS field_8mze FROM reduce_ri5s), map_tgvp (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_7t04), reduce_d_vq (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_tgvp GROUP BY field_6zur), map_dyq9 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, (1) / ((greatest(1, (sqrt(field_8mze)) / ((24))))) AS field_8mze FROM reduce_d_vq), join_wd2i (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT * FROM map_vb83 AS _LEFT_ JOIN map_dyq9 AS _RIGHT_ ON (_LEFT_._PROTECTED_ENTITY_ID_) = (_RIGHT_._PROTECTED_ENTITY_ID_)), map_07e6 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, (field_8mze) * ((_SCALE_FACTOR_field_8mze)) AS field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_ AS _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze AS _SCALE_FACTOR_field_8mze FROM join_wd2i), map__ivg (field_b_lu) AS (SELECT field_8mze AS field_b_lu FROM map_07e6), reduce_xmbc (field_8mze) AS (SELECT sum(field_b_lu) AS field_8mze FROM map__ivg), map_nmqi (_SUM_field_8mze) AS (SELECT least(2400000000, greatest(0, (field_8mze) + ((239.31951076972163) * (((sqrt((-2) * ((ln(random()))))) * ((cos((6.283185307179586) * ((random())))))))))) AS _SUM_field_8mze FROM reduce_xmbc), map_2u6g (field_nnl2) AS (SELECT _SUM_field_8mze AS field_nnl2 FROM map_nmqi) SELECT * FROM map_2u6g",
  "signature": "SBUJbslAMswREXP90hdoB2TxgyETnBDZ0FXMcKJtv5YKlBOhyG9+z1nAS6ewmoiD8fl+4GZZV9W7YwNWVh6bxEsM8ThSGeddX2Jh/blVGWgn8+vmn1et98dKVX/Bmg/4PKGOmOx9xGCEQEgclx2cdineIVppwXetHFLGMmmcJ28AFS+JUQqlmnQ6LqqqR8VrL68et8QmQasnBQOkW+gYIa+7XTl05BEiMI+WH4Cn/CNfPnpOygudkp1yFXP5YtbO3X5zo3TzDGltbg1yApVJouYGwqVCbSQTLQj1tjJlE6MIVHrt0Yg172qi0jC+6SZtxlWbQn/mDhN9s91tiB8BOA"
}

### Verify the dp version of the relation (altered signature)
POST https://qrlew-zsyaspsckq-od.a.run.app/verify HTTP/1.2
content-type: application/json

{
  "value": "WITH join_8sh3 (field_p7b0, field_sjgm, field_bhim, field_0lza, field_hbhz, field_vyw9, field_4wsv) AS (SELECT * FROM schema.user_table AS _LEFT_ JOIN schema.action_table AS _RIGHT_ ON (_RIGHT_.user_id) = (_LEFT_.id)), map_phke (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, action, user_id, duration) AS (SELECT md5(CAST(field_p7b0 AS VARCHAR)) AS _PROTECTED_ENTITY_ID_, 1 AS _PROTECTED_ENTITY_WEIGHT_, field_hbhz AS action, field_vyw9 AS user_id, field_4wsv AS duration FROM join_8sh3), map_kzp0 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, duration AS field_8mze FROM map_phke WHERE ((duration) > (0)) AND ((duration) < (24))), map_vb83 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, field_8mze AS field_8mze FROM map_kzp0), map_jpue (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_vb83), reduce_ri5s (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_jpue GROUP BY field_6zur), map_7t04 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, abs((field_8mze) * ((field_8mze))) AS field_8mze FROM reduce_ri5s), map_tgvp (field_b_lu, field_6zur) AS (SELECT field_8mze AS field_b_lu, _PROTECTED_ENTITY_ID_ AS field_6zur FROM map_7t04), reduce_d_vq (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT field_6zur AS _PROTECTED_ENTITY_ID_, sum(field_b_lu) AS field_8mze FROM map_tgvp GROUP BY field_6zur), map_dyq9 (_PROTECTED_ENTITY_ID_, field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, (1) / ((greatest(1, (sqrt(field_8mze)) / ((24))))) AS field_8mze FROM reduce_d_vq), join_wd2i (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT * FROM map_vb83 AS _LEFT_ JOIN map_dyq9 AS _RIGHT_ ON (_LEFT_._PROTECTED_ENTITY_ID_) = (_RIGHT_._PROTECTED_ENTITY_ID_)), map_07e6 (_PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_, field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze) AS (SELECT _PROTECTED_ENTITY_ID_ AS _PROTECTED_ENTITY_ID_, _PROTECTED_ENTITY_WEIGHT_ AS _PROTECTED_ENTITY_WEIGHT_, (field_8mze) * ((_SCALE_FACTOR_field_8mze)) AS field_8mze, _SCALE_FACTOR__PROTECTED_ENTITY_ID_ AS _SCALE_FACTOR__PROTECTED_ENTITY_ID_, _SCALE_FACTOR_field_8mze AS _SCALE_FACTOR_field_8mze FROM join_wd2i), map__ivg (field_b_lu) AS (SELECT field_8mze AS field_b_lu FROM map_07e6), reduce_xmbc (field_8mze) AS (SELECT sum(field_b_lu) AS field_8mze FROM map__ivg), map_nmqi (_SUM_field_8mze) AS (SELECT least(2400000000, greatest(0, (field_8mze) + ((239.31951076972163) * (((sqrt((-2) * ((ln(random()))))) * ((cos((6.283185307179586) * ((random())))))))))) AS _SUM_field_8mze FROM reduce_xmbc), map_2u6g (field_nnl2) AS (SELECT _SUM_field_8mze AS field_nnl2 FROM map_nmqi) SELECT * FROM map_2u6g",
  "signature": "_SBUJbslAMswREXP90hdoB2TxgyETnBDZ0FXMcKJtv5YKlBOhyG9+z1nAS6ewmoiD8fl+4GZZV9W7YwNWVh6bxEsM8ThSGeddX2Jh/blVGWgn8+vmn1et98dKVX/Bmg/4PKGOmOx9xGCEQEgclx2cdineIVppwXetHFLGMmmcJ28AFS+JUQqlmnQ6LqqqR8VrL68et8QmQasnBQOkW+gYIa+7XTl05BEiMI+WH4Cn/CNfPnpOygudkp1yFXP5YtbO3X5zo3TzDGltbg1yApVJouYGwqVCbSQTLQj1tjJlE6MIVHrt0Yg172qi0jC+6SZtxlWbQn/mDhN9s91tiB8BOA"
}

### Get the pep version of the relation
POST https://qrlew-zsyaspsckq-od.a.run.app/rewrite_as_protected_entity_preserving_with_dot HTTP/1.2
content-type: application/json

{"dataset":{"tables":[{"name":"user_table","path":["schema","user_table"],"schema":{"fields":[{"name":"id","data_type":"Integer"},{"name":"name","data_type":"Text"},{"name":"age","data_type":"Integer"},{"name":"weight","data_type":"Float"}]},"size":10000},{"name":"action_table","path":["schema","action_table"],"schema":{"fields":[{"name":"action","data_type":"Text"},{"name":"user_id","data_type":"Integer"},{"name":"duration","data_type":"Float"}]},"size":10000}]},"query":"SELECT * FROM action_table","synthetic_data":[["user_table","synthetic_user_table"],["action_table","synthetic_action_table"]],"protected_entity":[["user_table",[],"id"],["action_table",[["user_id","user_table","id"]],"id"]],"epsilon":1.0,"delta":0.00001}

### Get the dp version of the relation
POST https://qrlew-zsyaspsckq-od.a.run.app/rewrite_with_differential_privacy_with_dot HTTP/1.2
content-type: application/json

{"dataset":{"tables":[{"name":"user_table","path":["schema","user_table"],"schema":{"fields":[{"name":"id","data_type":"Integer"},{"name":"name","data_type":"Text"},{"name":"age","data_type":"Integer"},{"name":"weight","data_type":"Float"}]},"size":10000},{"name":"action_table","path":["schema","action_table"],"schema":{"fields":[{"name":"action","data_type":"Text"},{"name":"user_id","data_type":"Integer"},{"name":"duration","data_type":"Float"}]},"size":10000}]},"query":"SELECT sum(duration) FROM action_table WHERE duration > 0 AND duration < 24","synthetic_data":[["user_table","synthetic_user_table"],["action_table","synthetic_action_table"]],"protected_entity":[["user_table",[],"id"],["action_table",[["user_id","user_table","id"]],"id"]],"epsilon":1.0,"delta":0.00001}
